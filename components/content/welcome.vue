<template>
  <section>
    <section class="first-step h-[100vh]  z-10" >
      <!-- ACCUEIL -->
      <div id="home" class="item article flex-row bg-black" >
          <div class="center relative -rotate-6 welcome" >
            <h2>
              <span>INDEPENDENT</span> 
              <span><b class="text-yellow" style="filter:url(#pixelateMin);">FRONT</b> & <b style="filter:url(#pixelateMax);" class="text-yellow" >BACK</b>-END</span> 
              <span>WEB DEVELOPER</span>
            </h2>
            <p class="glitch " data-text="welcome here !">welcome here !</p>
          </div>
          <!--
            <Projects-background class="fixed left-0 z-[1]"/>
          -->
      </div>
      <!-- SEP -->
      <div class="separateur horizon text-2xl sep bg-black ">
        <div class="animate-horizontalTextScrolling ">
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
          <span class="text-yellow font-aktura leading-[70px]">piks-l</span>
          <span class="text-white font-aliseo leading-[70px]">INDEPENDENT FONT & BACK-END WEB DEVELOPER</span>
        </div>
      </div>
    </section>

    <section class="scnd-step ">
        <div id="projects" class="item article bg-transparent overflow-y-hidden">
            <!-- TITRE 
            <h2 class="title-section z-0">
              <span class="t1">selected</span> 
              <span class="t2">Projects</span>  
            </h2>
            -->
            <!-- SLIDER 
            <div class="w-full h-full border-2 border-yellow  py-20" style="height:calc(100vh - 210px);">

              <div id="slider" class="h-full">
                <div data-id="slider1" class="h-full" >

                  <div class="flex items-center justify-around h-full px-20 z-20 relative">
                    <div class="w-2/3 h-full text-center pr-20 flex flex-col items-center justify-around">
                      <h2 class="title-section z-0">
                        <span class="t1" style="filter:url(#pixelateOnScroll);">electro alternativ</span>   
                      </h2>
                      <div class="scrollbar-container-slider mx-auto">
                        <div class="scrollbar-progress-slider" id="indicatorSlider"></div>
                      </div>
                      <div class="w-full mx-auto text-center flex flex-row mt-20 text-3xl font-aliseo">
                          <span class="p-5 font-aktura">web.dev</span>
                          <p class="text-yellow mx-auto active-animatioon inline-block p-5 font-aktura">en voir plus</p>
                          <span  class="p-5 text-yellow">2022</span>
                        </div>
                    </div>



                    <div class="h-full w-1/3 items-center grid grid-cols-1">
                      <div class="h-full w-full m-auto flex justify-around items-center" style="backdrop-filter: saturate(100%);">
                        <img class="w-full h-full bg-cover bg-center object-cover saturate-0 bg-yellow  mx-auto tilt-elem absolute" style="transform: translateZ(100px); filter:url(#pixelateMax);" src="~/assets/img/projects/electro-alternativ-2022/cover-intro.jpg" />                       
                        <div class="w-[350px] h-[350px] mx-auto active-animatioon  tilt-elem absolute" data-tilt-perspective="550" style="transform: translateZ(0px)" data-tilt-reverse="true" data-tilt-scale="1.1"></div>
                        <img class="w-[350px] h-[350px] mx-auto tilt-elem absolute" style="transform: translateZ(100px);" src="~/assets/img/projects/electro-alternativ-2022/article-ea3.jpg" />                       
                        <div class="h-[350px] w-[350px] mx-auto border-2 border-dotted border-yellow tilt-elem absolute" style="transform: translateZ(200px)" data-tilt-perspective="500" data-tilt-scale="0.8"></div>
                      </div>
                    </div>
                  </div>
                  <div class="separateur horizonslider text-2xl sep z-10 relative">
                      <div class="animate-horizontalTextScrolling">
                        <span class="text-yellow font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                        <span class="text-yellow font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                        <span class="text-yellow font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                        <span class="text-yellow font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                        <span class="text-yellow font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                        <span class="text-yellow font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                      </div> 
                      <div class="rotate-180"> 
                        <div class="animate-horizontalTextScrolling ">
                          <span class="text-white font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                          <span class="text-white font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                          <span class="text-white font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                          <span class="text-white font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                          <span class="text-white font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                          <span class="text-white font-aliseo">ELECTRO ALTERNATIV - 2022 - ELECTRO ALTERNATIV - 2022 - </span>
                        </div>
                      </div> 
                  </div> 
                </div>
              </div>
          
              <div class="fixed top-1/2 translate-y-1/2 right-0 rotate-90">
                <span class="text-yellow inline-block ">&#60;</span>
                <ul class="text-white  inline-block">
                  <li class="active inline-block">+</li>
                  <li class="notactive inline-block">-</li>
                  <li class="notactive inline-block">-</li>
                  <li class="notactive inline-block">-</li>
                  <li class="notactive inline-block">-</li>
                </ul> 
                <span class="text-yellow inline-block">&#62;</span> 
              </div>

            </div>
            -->
            <!-- SELECTED WORKS-->
            <Content-slider  class="" />
            

            <!-- SEP 
            <div class="separateur horizon text-2xl sep bg-black">
                <div class="animate-horizontalTextScrolling">
                <span class="text-white font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                <span class="text-white font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                <span class="text-white font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                <span class="text-white font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                <span class="text-white font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                </div> 
                <div class="rotate-180"> 
                <div class="animate-horizontalTextScrolling ">
                    <span class="text-yellow font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                    <span class="text-yellow font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                    <span class="text-yellow font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                    <span class="text-yellow font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span>
                    <span class="text-yellow font-aliseo">INDEPENDENT FONT & BACK-END WEB DEVELOPER - AVAILABLE FOR WORK - </span> 
                </div>
                </div> 
            </div> 
            --> 
        </div>
    </section>
    <section class="three-step bg-black  h-[100vh]  ">
    
            <div class="item article">
                <div class="absolute left-0 top-1/2 w-1/2 mx-[25%] -translate-y-1/2">
                  <h2>
                    <span  style="filter:url(#pixelateMin);">KNOW</span> 
                    <span  class="directGlitch">MORE</span> 
                    <span  style="filter:url(#pixelateMax);">ABOUT</span> 
                    <span class=""><Ui-logo-texte/></span>
                  </h2>
                </div>
            </div>


    </section> 
  </section>
</template>
<style lang="postcss">

/* SECTION 1 */
  #home h2{ @apply text-white font-aliseo text-[150px] leading-[150px] w-full;}
  #home h2 span:nth-child(1){ @apply text-center ; }
  #home h2 span:nth-child(2){ @apply text-left ; }
  #home h2 span:nth-child(3){ @apply text-right ; }
  #home p{ @apply text-white font-aktura text-[50px] leading-[50px] text-right relative; }
/* SECTION 2 */
  .scnd-step{z-index:1;}
  #projects { @apply z-20; background:transparent!important;}
  #projects h2{ @apply text-white font-aktura text-[150px] leading-[150px] text-center w-full;}
  #projects h2 span:nth-child(2){ @apply text-black font-aliseo; }
/* SECTION 3 */
  .three-step{z-index:2;}
  .three-step h2{ @apply text-white font-aliseo text-[150px] leading-[150px] w-full;}
  .three-step  h2 span{ @apply text-center block; }
/* AUTRES */  
  .article{ @apply w-full text-white h-full p-20 table relative;}
  .article h2 span{ @apply block ; }
  .center{ @apply table-cell align-middle; }
  .svg-filter{@apply invisible w-0 h-0}
  .active-animatioon {
    background-image: linear-gradient(90deg, #ffffff 50%, transparent 50%), linear-gradient(90deg, #ffffff 50%, transparent 50%), linear-gradient(0deg, #fff000 50%, transparent 50%), linear-gradient(0deg, #fff000 50%, transparent 50%);
    background-repeat: repeat-x, repeat-x, repeat-y, repeat-y;
    background-size: 15px 2px, 15px 2px, 2px 15px, 2px 15px;
    background-position: left top, right bottom, left bottom, right   top;
    animation: border-dance 1s infinite linear;
  }
  @keyframes border-dance {
    0% {
      background-position: left top, right bottom, left bottom, right   top;
    }
    100% {
      background-position: left 15px top, right 15px bottom , left bottom 15px , right   top 15px;
    }
  }

/* SEPARATEUR */
  .separateur {
    @apply overflow-hidden flex whitespace-nowrap rotate-180 text-center pl-[0vw];
    will-change: transform;
    -ms-writing-mode: tb-rl;
    writing-mode: vertical-rl;
    -webkit-text-orientation: mixed;
    text-orientation: mixed;
  }
  .separateur span { @apply leading-[70px]; }
  .separateur span:nth-of-type(odd) { @apply my-5; }
  .separateur span:nth-of-type(even) { @apply my-0; }
  .separateur.horizon span { @apply leading-[70px]; }
  .separateur.horizon{
    @apply rotate-0 border-t-2 block border-r-0 border-t-yellow border-b-2 border-l-0 border-b-white;
      writing-mode: initial;
      flex: 0 0 100vw !important;
      max-width: 100%;
      position: absolute;
      bottom: 0;
      left: 0;
  }
  .separateur.horizonslider span { @apply leading-[64px]; }
  .separateur.horizonslider{
    @apply rotate-0 block;
      writing-mode: initial;
      flex: 0 0 100vw !important;
      max-width: 100%;
      position: absolute;
      bottom: calc(50% - 64px);
      left: 0;
  }
</style>

<script>
  import {mapActions} from 'vuex'
  export default {
    data () {
      return {
        isPolyScrollTimelineLoaded: false,
        slides: [
          {
            name: 'Slide 1',
            img: 'https://picsum.photos/200/300'
          },
          {
            name: 'Slide 2',
            img: 'https://picsum.photos/200/300'
          },
          {
            name: 'Slide 3',
            img: 'https://picsum.photos/200/300'
          }
        ]
      }
    },
    methods: {
      animateOnScroll() {
      const gsap = this.$gsap;
      const ScrollTrigger = this.$ScrollTrigger;

        // SECTION 1 : ACCUEIL
        gsap.utils.toArray('.first-step').forEach(e => {	
          let elDisp = document.getElementById("feDisplacementMapScroll");
          let dispProxy = { scale: 5 };
          let dispSetter = gsap.quickSetter(elDisp, "attr");
          let dispClamp = gsap.utils.clamp(-10,10);

          gsap.timeline({ 
            ease: "power2",
            scrollTrigger: {
              trigger: e,		
              start: "top",
              end: "bottom",
              scrub: true,
              onUpdate: (e) => {
                let dispScale = dispClamp(e.getVelocity() * 5);
                if (Math.abs(dispScale) > Math.abs(dispProxy.scale)) {
                  dispProxy.scale = Math.round(dispScale);
                  gsap.to(dispProxy, {
                    scale: 5,
                    duration: 1,
                    ease: "power3",
                    overwrite: true,
                    onUpdate: () => {
                      //console.log(dispProxy.scale)
                      dispSetter({scale:dispProxy.scale});
                    }
                  });
                }
              }
            }
          });

          var opa0 = gsap.timeline({paused:true}).to(".welcome", {duration: 0.5, opacity: '0'}, "+=0");
          gsap.timeline({ 
            ease: "none",
            scrollTrigger: {
              trigger: e,		
              start: "center top+=70",
              end: "bottom-=70 top+=70",
              invalidateOnRefresh: true,
              //anticipatePin: 1,
              scrub: true,
              markers: {startColor: "red", endColor: "red", fontSize: "15px", fontWeight: "bold", indent: 0},
              onEnterBack: e => {
                opa0.play();
              },
              onLeaveBack: e => {
                opa0.reverse();
              },
              onEnter: e => {
                opa0.play();
              },
              onLeave: e => {
                opa0.play();
              },
            }
          });
        });	
        // SECTION 2 : WORKS
        gsap.utils.toArray(".scnd-step").forEach(e => {

          let elDisp = document.getElementById("feDisplacementMapScroll");
          let dispProxy = { scale: 5 };
          let dispSetter = gsap.quickSetter(elDisp, "attr");
          let dispClamp = gsap.utils.clamp(-20,20);

          var titleProjects = gsap.timeline({paused:true}).to('#projects .t2', {
              duration: 0.5, color: self.isActive ? color : '#fff000'
            }, "+=0");
          var imProjects = gsap.timeline({paused:true}).to('main', {
              duration: 0.5, backgroundColor: self.isActive ? backgroundColor : '#000000'
            }, "+=0");
          var imTitle = gsap.timeline({paused:true}).to('#projects .title', {
              duration: 0.5, color: self.isActive ? color : '#FFF000'
            }, "+=0");

          gsap.timeline({
                scrollTrigger: {
                      trigger: e,
                      start: "top-=70 top+=70",
                      end: "bottom-=70 top+=70",
                      scrub: true,
                      toggleActions: "play reverse play reverse",
                      onUpdate: (e) => {
                        let dispScale = dispClamp(e.getVelocity() / 5);
                        if (Math.abs(dispScale) > Math.abs(dispProxy.scale)) {
                          dispProxy.scale = Math.round(dispScale);
                          gsap.to(dispProxy, {
                            scale: 5,
                            duration: 1,
                            ease: "power3",
                            overwrite: true,
                            onUpdate: () => {
                              //console.log(dispProxy.scale)
                              dispSetter({scale:dispProxy.scale});
                            }
                          });
                        }
                      },
                      onEnterBack: e => {
                        imProjects.play();
                        imTitle.play();
                        titleProjects.play();
                      },
                      onLeaveBack: e => {
                        imProjects.reverse();
                        imTitle.reverse();
                        titleProjects.reverse();
                      },
                      onEnter: e => {
                        imProjects.play();
                        imTitle.play();
                        titleProjects.play();
                      },
                      onLeave: e => {
                        imProjects.reverse();
                        imTitle.reverse();
                        titleProjects.reverse();
                      },
                      markers: {startColor: "purple", endColor: "purple", fontSize: "15px", fontWeight: "bold", indent: 300}
                }
              });
          


          dispProxy.scale = 0;


        });
        

        
      },
      smoothScroll() {
        const gsap = this.$gsap;
        const ScrollTrigger = this.$ScrollTrigger;
        smoothScroll("main");
        function smoothScroll(content, viewport, smoothness) {
          content = gsap.utils.toArray(content)[0];
          smoothness = smoothness || 1;

          gsap.set(viewport || content.parentNode, {overflow: "hidden", position: "fixed", height: "100%", width: "100%", top: 0, left: 0, right: 0, bottom: 0});
          gsap.set(content, {overflow: "visible", width: "100%"});

          let getProp = gsap.getProperty(content),
            setProp = gsap.quickSetter(content, "y", "px"),
            setScroll = ScrollTrigger.getScrollFunc(window),
            removeScroll = () => content.style.overflow = "visible",
            killScrub = trigger => {
              let scrub = trigger.getTween ? trigger.getTween() : gsap.getTweensOf(trigger.animation)[0]; // getTween() was added in 3.6.2
              scrub && scrub.pause();
              trigger.animation.progress(trigger.progress);
            },
            height, isProxyScrolling;

          function refreshHeight() {
            height = content.clientHeight;
            content.style.overflow = "visible"
            document.body.style.height = height + "px";
            return height - document.documentElement.clientHeight;
          }

          ScrollTrigger.addEventListener("refresh", () => {
            removeScroll();
            requestAnimationFrame(removeScroll);
          })
          ScrollTrigger.defaults({scroller: content});
          ScrollTrigger.prototype.update = p => p; // works around an issue in ScrollTrigger 3.6.1 and earlier (fixed in 3.6.2, so this line could be deleted if you're using 3.6.2 or later)

          ScrollTrigger.scrollerProxy(content, {
            scrollTop(value) {
              if (arguments.length) {
                isProxyScrolling = true; // otherwise, if snapping was applied (or anything that attempted to SET the scroll proxy's scroll position), we'd set the scroll here which would then (on the next tick) update the content tween/ScrollTrigger which would try to smoothly animate to that new value, thus the scrub tween would impede the progress. So we use this flag to respond accordingly in the ScrollTrigger's onUpdate and effectively force the scrub to its end immediately.
                setProp(-value);
                setScroll(value);
                return;
              }
              return -getProp("y");
            },
            scrollHeight: () => document.body.scrollHeight,
            getBoundingClientRect() {
              return {top: 0, left: 0, width: window.innerWidth, height: window.innerHeight};
            }
          });

          return ScrollTrigger.create({
            animation: gsap.fromTo(content, {y:0}, {
              y: () => document.documentElement.clientHeight - height,
              ease: "none",
              onUpdate: ScrollTrigger.update
            }),
            scroller: window,
            invalidateOnRefresh: true,
            start: 0,
            end: refreshHeight,
            refreshPriority: -999,
            scrub: smoothness,
            onUpdate: self => {
              if (isProxyScrolling) {
                killScrub(self);
                isProxyScrolling = false;
              }
            },
            onRefresh: killScrub // when the screen resizes, we just want the animation to immediately go to the appropriate spot rather than animating there, so basically kill the scrub.
          });
        }
      }
    },
    mounted() {
      this.animateOnScroll();
      //this.smoothScroll();
    }
  }
</script>
